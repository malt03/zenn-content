---
title: "Unityã§ãƒ“ãƒ«ãƒ‰ã—ãŸiOSã‚¢ãƒ—ãƒªã®ãƒ“ãƒ«ãƒ‰è¨­å®šã‚’è‡ªå‹•ã§å¤‰æ›´ã™ã‚‹"
emoji: "ğŸ˜"
type: "tech"
topics: ["Unity", "iOS"]
published: true
---

Unity ã§ iOS ã‚¢ãƒ—ãƒªã‚’ãƒ“ãƒ«ãƒ‰ã™ã‚‹ã¨ Xcode ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒç”Ÿæˆã•ã‚Œã‚‹ãŒã€Xcode ã§è¨­å®šã‚’æ›¸ãæ›ãˆã¦ã‚‚ãƒ“ãƒ«ãƒ‰ã™ã‚‹ãŸã³ã«æ›¸ãæ›ãˆãŸè¨­å®šã¯ãƒªã‚»ãƒƒãƒˆã•ã‚Œã¦ã—ã¾ã†ã€‚

ãã‚Œã‚’ãªã‚“ã¨ã‹ã™ã‚‹æ–¹æ³•ã€‚

# IPostprocessBuildWithReport

Assets/Editor ã¨ã„ã†ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œã£ã¦ã€ãã“ã« `IPostprocessBuildWithReport` ã‚’å®Ÿè£…ã—ãŸã‚¯ãƒ©ã‚¹ã‚’ç½®ã„ã¦ãŠãã¨ã€ãƒ“ãƒ«ãƒ‰å®Œäº†å¾Œã«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’èµ°ã‚‰ã›ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚

`IPreprocessBuildWithReport` ã¨ã„ã†ã®ã‚‚ã‚ã£ã¦ãƒ“ãƒ«ãƒ‰å‰ã«ã‚‚å‡¦ç†ã‚’æŒŸã‚ã‚‹ãŒã€ã‚ã¾ã‚Šä½¿ã†ã“ã¨ã¯ãªã•ãã†ã€‚

ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¯ã„ãŸã£ã¦ã‚·ãƒ³ãƒ—ãƒ«ã€‚

```csharp:BuildPostprocessor.cs
using UnityEditor.Build;
using UnityEditor.Build.Reporting;

public class BuildPostprocessor : IPostprocessBuildWithReport {
  public int callbackOrder => 1;

  public void OnPostprocessBuild(BuildReport report) {
    // ã“ã“ã§è‰²ã€…å‡¦ç†ã§ãã‚‹
  }
}

```

# ä½¿ç”¨ä¾‹

ä¾‹ã¨ã—ã¦ã€å®Ÿéš›ã«è‡ªåˆ†ãŒä½¿ã£ã¦ã„ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’æ›¸ã„ã¦ãŠãã€‚

Unity ã§ãƒ“ãƒ«ãƒ‰ã—ãŸ Xcode ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ `Supported Destinations` ã« `Mac (Designed for iPad)` ã¨ `Apple Vision (Designed for iPad)` ãŒå­˜åœ¨ã—ã¦ã„ã‚‹ã€‚

ã“ã‚Œã«ã‚ˆã‚Š iOS å‘ã‘ã«ä½œæˆã—ãŸã‚²ãƒ¼ãƒ ãŒ Mac ã‚„ Apple Vision ã§å‹•ã‹ã›ã‚‹ã‚ã‘ã ãŒã€ä½•ã‚„ã‹ã‚“ã‚„å‹•ã‹ãªã„ã“ã¨ã‚‚å¤šã„ã€‚

è‡ªåˆ†ã®ã‚²ãƒ¼ãƒ ã§ã¯ Admob ã§åºƒå‘Šã‚’å®Ÿè£…ã—ã¦ã„ã‚‹ãŒã€[User Messaging Platform](https://developers.google.com/admob/unity/privacy) ã‚’ä½¿ã£ã¦å‡ºã—ãŸåŒæ„ãƒ•ã‚©ãƒ¼ãƒ ãŒ Mac ã§ã¯ã‚¯ãƒªãƒƒã‚¯ã§ããªã„å•é¡ŒãŒã‚ã‚‹ã€‚

https://github.com/googleads/googleads-mobile-unity/issues/3674

ãã“ã§ã€è‡´ã—æ–¹ãªãã“ã®äºŒã¤ã‚’å‰Šé™¤ã™ã‚‹ã‚ˆã†è¨­å®šã‚’å¤‰æ›´ã—ã¦ã„ã‚‹ã€‚

```csharp:BuildPostprocessor.cs
using UnityEditor;
using UnityEditor.Build;
using UnityEditor.Build.Reporting;
using UnityEditor.iOS.Xcode;

public class BuildPostprocessor : IPostprocessBuildWithReport {
  public int callbackOrder => 1;

  public void OnPostprocessBuild(BuildReport report) {
    var buildTarget = report.summary.platform;
    if (buildTarget == BuildTarget.iOS) ProcessForiOS(report);
  }

  void ProcessForiOS(BuildReport report) {
    var project = new PBXProject();

    var buildOutputPath = report.summary.outputPath;
    var pbxProjectPath = PBXProject.GetPBXProjectPath(buildOutputPath);
    project.ReadFromFile(pbxProjectPath);

    var mainTarget = project.GetUnityMainTargetGuid();
    project.SetBuildProperty(mainTarget, "SUPPORTS_MACCATALYST", "NO");
    project.SetBuildProperty(mainTarget, "SUPPORTS_MAC_DESIGNED_FOR_IPHONE_IPAD", "NO");
    project.SetBuildProperty(mainTarget, "SUPPORTS_XR_DESIGNED_FOR_IPHONE_IPAD", "NO");

    project.WriteToFile(pbxProjectPath);
  }
}
```

# è¨­å®šå€¤ã®èª¿ã¹æ–¹

Xcode ã®è¨­å®šå¤‰æ›´ã«å¯¾å¿œã—ãŸ `SetBuildProperty` ã«æ¸¡ã™å¼•æ•°ã‚’èª¿ã¹ã‚‹ã«ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ã™ã‚‹ã¨ã‚ˆã„ã€‚

1. ç”Ÿæˆã—ãŸ Xcode ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã« cd
2. `git init && git add -A`
   1. ã“ã®ã¨ãã€`Libraries` `Pods` `Il2CppOutputProject` ã‚ãŸã‚ŠãŒã‚ã‚‹ã¨ add ã«æ™‚é–“ãŒã‹ã‹ã‚‹ãŸã‚ ignore ã—ã¦ãŠã
3. Xcode ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä»»æ„ã®è¨­å®šã‚’å¤‰æ›´
4. `git diff`

ã“ã‚Œã§ Xcode ã§å¤‰æ›´ã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒã©ã®ã‚ˆã†ã«è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã«å½±éŸ¿ã‚’åŠã¼ã—ãŸã‹ãŒã‚ã‹ã‚‹ã®ã§ã€ãã‚Œã‚’ãã®ã¾ã¾å¼•æ•°ã¨ã—ã¦æ¸¡ã™ã€‚
